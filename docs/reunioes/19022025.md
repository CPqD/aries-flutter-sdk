# ğŸš€ Acesso ao Staging

## ğŸ”— Portal de Empresas

Acesse o ambiente de staging para visualizar mÃ©tricas de emissÃ£o, provas e outras informaÃ§Ãµes essenciais:

ğŸ”— **Link de acesso:** [Staging Portal Empresas](https://staging-id-besu.cpqd.com.br/empresas/)

<img src="../images/login-staging.png" alt="Portal Empresas" width="200">

---

## ğŸ“Š MÃ©tricas

No portal, vocÃª pode visualizar informaÃ§Ãµes detalhadas sobre emissÃµes, provas e demais mÃ©tricas.

 <img src="../images/metricas-staging.png" alt="Portal Empresas - mÃ©tricas" width="600">

---

## ğŸŸï¸ Acesso Ã  Carteira

Para visualizar os detalhes da sua carteira, como nome e secret (necessÃ¡rio para obter o token):

ğŸ”¹ **Navegue atÃ©:** `Minha Carteira` <br>
ğŸ”¹ **Nome da Carteira** e **Secret** disponÃ­veis

 <img src="../images/carteira-staging.png" alt="Portal Empresas - Minha carteira" width="600">

---

## ğŸ”‘ Gerando Token do Emissor

Para autenticaÃ§Ã£o no **Auth Manager**, utilize a chamada:

```bash
curl -X POST 'https://staging-id-besu.cpqd.com.br/api/auth-manager/v1/token' \
--header 'Content-Type: application/json' \
--data '{
    "wallet_name":"{{WALLET_NAME}}",
    "password":"{{SECRET}}"
}'
```

Com o token gerado, Ã© possÃ­vel criar convites de conexÃ£o e enviar ofertas de credenciais.

---

## ğŸŒ ConexÃ£o com Mediador

Caso seja necessÃ¡rio que o agente receba mensagens com o aplicativo fechado, Ã© preciso conectar-se ao mediador.

ğŸ”— **Convite do Agente Mediador:** [Acesso ao Mediador](https://blockchain.cpqd.com.br/cpqdid/agent-mediator-endpoint-com)

ApÃ³s conexÃ£o, a seguinte tela deve ser exibida:

<img src="../images/conexao_mediador.png" alt="Mediador conectado" width="200">

---

## âœ‰ï¸ Criando um Convite de ConexÃ£o

```bash
curl -X POST 'https://staging-id-besu.cpqd.com.br/api/hub-issuer/agent/v2/out-of-band/create-invitation' \
--header 'Authorization: Bearer {{token}}' \
--header 'Content-Type: application/json' \
--data '{
    "alias": "alias for the connection",
    "my_label": "label for the connection invitation",
    "metadata": {},
    "handshake_protocols": [
        "https://didcomm.org/connections/1.0"
    ],
    "accept": [
        "didcomm/aip1",
        "didcomm/aip2;env=rfc19"
    ]
}'
```

ApÃ³s a requisiÃ§Ã£o, copie o `invitation_url` e gere um QR Code:

ğŸ”— [Gerar QR Code](https://www.canva.com/qr-code-generator/)

ğŸ“± No celular, escaneie o QR Code para completar a conexÃ£o:

<img src="../images/invitation_url.png" alt="Convite de conexÃ£o" width="200">

---

## ğŸ”„ Obtendo Connection ID

```bash
curl -X GET 'https://staging-id-besu.cpqd.com.br/api/hub-issuer/agent/v2/connections?invitation_msg_id={{invi_msg_id}}' \
--header 'Authorization: Bearer {{token}}' \
--header 'Content-Type: application/json' \
--data ''
```

---

## ğŸ’¬ Troca de Mensagens

```bash
curl -X POST 'https://staging-id-besu.cpqd.com.br/api/hub-issuer/agent/v2/connections/{{connection_id}}/send-message' \
--header 'Authorization: Bearer {{token}}' \
--header 'Content-Type: application/json' \
--data '{
    "content": "mensagem a ser enviada"
}'
```

ğŸ“± Com o aplicativo aberto, a mensagem serÃ¡ exibida:

<img src="../images/aplicativo_aberto.png" alt="Mensagem chegou com o app aberto" width="200">

Caso o app esteja fechado, ao abrir ele exibirÃ¡ a mensagem:

<img src="../images/aplicativo_fechado.png" alt="Mensagem chegou com o app fechado" width="200">

---

## ğŸ“œ EmissÃ£o de Credencial

No portal, hÃ¡ a opÃ§Ã£o de criar **definiÃ§Ãµes de credencial**, incluindo dados como **nome, e-mail e data de nascimento**.

<img src="../images/emissao_staging.png" alt="EmissÃ£o de credencial via portal" width="600">

---

## ğŸ”— Links Ãšteis

- ğŸ“š [DocumentaÃ§Ã£o de Desenvolvimento](https://staging-id-besu.cpqd.com.br/docs/developerGuide.html)
- ğŸ› ï¸ [Swagger API](https://staging-id-besu.cpqd.com.br/docs/swagger/?urls.primaryName=agent)
- ğŸ¢ [Portal Empresas](https://staging-id-besu.cpqd.com.br/empresas)
- ğŸ”„ [Convite do Agente Mediador](https://blockchain.cpqd.com.br/cpqdid/agent-mediator-endpoint-com)

---

## ğŸ› ï¸ Environment e Collection (Postman)

- [ğŸ”— IntegraÃ§Ãµes com iD - Postman Collection](../utils/IntegraÃ§Ãµes%20com%20iD.postman_collection.json)
- [ğŸ”— IntegraÃ§Ãµes iD - Postman Environment](../utils/IntegraÃ§Ãµes%20iD.postman_environment.json)

ğŸš€ *Mantenha este documento atualizado conforme novas funcionalidades forem adicionadas!*